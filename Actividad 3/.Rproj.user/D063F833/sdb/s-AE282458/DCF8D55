{
    "contents" : "---\ntitle: \"Actividad 1. Modelamiento de Demanda 2\"\nauthor: \"nclivio\"\ndate: '2014'\noutput: pdf_document\n---\n\n##Introducción\nA continuación se detalla la comparación de modelos para pronosticar la demanda empleando modelos de curvas de crecimiento, modelo Bass y el modelo Fisher-Pry. \n\n##Descripción de los Datos\nSe eligieron datos provenientes del paquete **fpp**, del libro Forecasting: Principles and Practice por Rob J Hyndman and George Athanasopoulos. Se trabajo con un dataset con un formato de series de tiempo anual ya que coincide con el formato de la demanda de usuarios requerido para el desarrollo de la tesis.\n\n\n##Preparación de Datos\nEs necesario cargar el paquete **fpp**, se trabajará con el data set **ausair** Air Transport Passengers Australia, que contiene el total de pasajeros los años comprendidos entre 1970 y 2009.\n\n```{r message=FALSE,warning=FALSE}\nlibrary(fpp)\ndata(ausair)\n\nplot(ausair, xlab=\"Años\",ylab=\"Pasajeros [Millones]\",col=\"salmon\",lwd=3, \n     main=\"Pasajeros\")\n```\n\nSe submuestrean los datos en dos grupos *training* para aplicar el modelo y *testing* para hacer las predicciones.\n\n```{r message=FALSE,warning=FALSE}\nlibrary(caret)\nlibrary(ggplot2)\n\nts<-ausair\n\ntstrain<-window(ts,start=1970,end=1999)\ntstest<-window(ts,start=1999,end=(2009))       \n\nyears<-c(1970:1999)\ndatatrain<-data.frame(Años=years,Pasajeros=tstrain)\n\nyears2<-c(1999:2009)\ndatatest<-data.frame(Años=years2,Pasajeros=tstest)\n\n#inTrain<-createDataPartition(y=data$Años, p=0.75, list=FALSE)\n#training<-data[inTrain,]\n#testing<-data[-inTrain,]\n```\n\nEl conjunto de datos *training*, se muestra a continuación:\n```{r message=FALSE,warning=FALSE}\nplot(tstrain, xlab=\"Años\",ylab=\"Pasajeros [Millones]\",col=\"yellowgreen\",lwd=3,main=\"Datos Training\")\n```\n\n\n##Modelos y Predicciones\n````{r message=FALSE,warning=FALSE}\nlibrary(grofit)\nlibrary (forecast)\n````\n\n\n###1.Modelos Lineales\nA continuación se aplica, el modelo de regresión lineal, donde la variable independiente es el tiempo (Años) y la dependiente la cantidad de pasajeros.\n\n```{r message=FALSE,warning=FALSE}\n\nfitlm<-tslm(tstrain~trend)\n\nfitlm\n```\n\nSe hacen las predicciones\n```{r message=FALSE,warning=FALSE}\n\npredlm<-forecast(fitlm, h=15)\n\n```\n\n\nGraficamente la predicción del modelo lineal, se ve asi:\n````{r}\nplot(predlm)\nlines(tstest,lwd=1,col=\"orangered\")\n```\n\n\n###2.Modelos Parabólico\nAplicando un modelo con tendencia no lineal, de forma polinómica de segundo grado de la forma:\n\n**y = b0 + b1 x + b2 x^2**\n\nDonde:\nb0 : Intersección estimada con el eje y\nb1 : efecto lineal estimado sobre y\nb2 : efecto curvilíneo estimado sobre y\n\nSe obtiene:\n\n````{r message=FALSE,warning=FALSE}\n\ntime<-1:30\nregpol = lm(tstrain ~ time + I(time^2))\n\nsummary(regpol)\n\npredpol<-predict(regpol)\n\nplot(tstrain,lwd=2,main=\"Modelo Parabólico\",ylab=\"Pasajeros [Millones]\",col=\"blue\")\nlines(years,predpol, col=\"red\") \n\n````\n\n\n###3.Modelos Exponencial\nLa función **ets** del paquete forecast, sirve para ajustar modelos de tipo exponencial.\n*Fuente:* <http://www.statmethods.net/advstats/timeseries.html>\n\n````{r message=FALSE,warning=FALSE}\n\n#Exponential smoothing state space model\n\nfitexp <- ets(tstrain)\npredexp<-forecast(fitexp)\n\nplot(predexp)\nlines(tstest,lwd=1,col=\"orangered\")\n\npredexp\n\nsummary(fitexp)\n````\n\n\n###4.Modelos Logístico\nUsando el paquete **growthmodels** se usa la función *logistic* para calcular la curva de crecimiento logistica.\n\n**Usage**\nlogistic(t, alpha, beta, k)\n\n**Arguments**\nt     time\nx     size\nalpha upper asymptote\nbeta  growth range\nk     growth rate\n\n````{r echo=FALSE, message=FALSE,warning=FALSE}\nlibrary(growthmodels)\n\nalpha<-50 #Nivel de saturación de mercado\nbeta<-10  #Rango de crecimiento\nk<-0.1    #Tasa de crecimiento\n  \nfitlog <- logistic(tstrain, alpha, beta, k)\npredlog<-forecast(fitlog)\nplot(predlog,lwd=1,main=\"Forecast from Logistic model\")\nlines(tstrain,lwd=1,col=\"orangered\")\n\nsummary(predlog)\n\n````\n\n\n###5.Modelos Gompertz\nUsando el paquete **growthmodels** se usa la función *gompertz* para calcular la curva de crecimiento.\n\n**Usage**\ngompertz(t, alpha, beta, k)\n\ngompertz.inverse(x, alpha, beta, k)\n\n**Arguments**\nt time\n\nx size\n\nalpha upper asymptote\n\nbeta growth displacement\n\nk growth rate\n\n````{r message=FALSE,warning=FALSE}\nalphag<-50 #alpha upper asymptote\nbetag<-6  #beta growth displacement\nkg<-0.1   #growth rate\n  \nfitgom<-gompertz(tstrain, alphag, betag, kg)\n\npredgom<-forecast(fitgom)\n\nplot(predgom,lwd=1,main=\"Forecast from Gompertz model\")\nlines(tstrain,lwd=1,col=\"orangered\")\n\n\nsummary(predgom)\n\n````\n\n\n###5.Modelos Fisher Pry\nModelo matemático utilizado para predecir la adopción de tecnología cuando la sustitución es impulsado por una tecnología superior en el que el nuevo producto o servicio presenta alguna ventaja tecnológica sobre el anterior.\n\n````{r message=FALSE,warning=FALSE}\ntime<-(years-mean(years))*2\n\nparmlm<-as.list(fitlm$coeff)\n\na<-parmlm$\"(Intercept)\"  \nb<-parmlm$trend    \n\nfitpry<-1/(1+exp(-b*(time-a)))\n````\n\nCurva **S** representa la adopción del servicio, es decir la penetración del mercado.\n\n````{r message=FALSE,warning=FALSE}\n\nplot(years,fitpry,lwd=1,col=\"green2\", main=\"Penetración en función del tiempo\", xlab=\"Tiempo\",ylab=\"f\")\nlines(years,fitpry,lwd=2,col=\"green4\")\npoints(1986.5,0.5,lwd=2,col=\"blue3\",pch=4)\ntext(1988, 0.5, \"(th,fh)\")\npoints(1990,1,lwd=2,col=\"blue3\",pch=4)\ntext(1990, 0.95, \"(to)\")\nabline(h=1,v=1990,lty=3,col=\"dodgerblue\")\nabline(h=0.5,v=1986.5,lty=3,col=\"dodgerblue\")\n````\n\nSe ha demostrado que la relación de Fisher Pry se cumple en bastantes sustituciones tecnológicas. Cuando se combina con la idea de que la curva de sustitución sigue también la curva S. \n\n**f/(1-f) = exp.2alpha(t-t0)**\n\ndonde:\nf= fracción de tecnología antigua sustituida por la nueva.\nalpha= 1/2 del crecimiento porcentual anual en los primeros años.\nto= tiempo cuando f= 1/2\n\n````{r message=FALSE,warning=FALSE}\nalpha<-2*0.5\nto<-1990\ntdelta<-to-years\n\nmodpry<-exp(alpha*(years-to))\n\nplot(years,modpry,lwd=2,col=\"hotpink3\", main=\"Modelo Fisher Pry\", xlab=\"Tiempo\",ylab=\"f/1-f\")\nlines(years,modpry,lwd=2,col=\"violet\")\nlines(tstrain,lwd=1,col=\"orangered\")\n````\n\n\n###6.Modelos Bass Model\n\nModelo propuesto por Frank M Bass en 1969. Este modelo propone que la difusión es motivada por la innovación que son los que adoptan un producto y los que los siguen son los imitadores.\n\n**M** Numero total de personas que eventualmente comprará el producto\n**P** Coeficiente de Innovación\n**Q** Coeficiente de Imitación\n\nPara resolver el modelo, se hace una regresión lineal para determinar los coeficientes del modelo\n\n````{r message=FALSE,warning=FALSE}\n\ntime<-(years-mean(years))*2\n\nregpol= lm(tstrain ~ time + I(time^2))\n\nparm<-as.list(regpol$coeff)\n\na<-parm$\"(Intercept)\"  \nb<-parm$time*(1)           \nc<-parm$\"I(time^2)\"    \n\n \n#Coeficientes del Modelo Bass\n\nP<-c\nQ<-b+P\nM<-a/P\n\n#M<-(-b-sqrt((b^2)-(4*a*c)))/(2*c)\n#P<-a/M\n#Q<--c*M\n\n\nCoeff<-data.frame(P=P,Q=Q,M=M)\nCoeff\n````\n\n\nUna vez se obtienen los parámetros, se reemplazan en la fórmula del modelo:\n\n````{r message=FALSE,warning=FALSE}\n\nter1<-P*M\nter2<-(Q-P)*tstrain\nter3<-(Q/M)*tstrain^2\n\nfitbas<-ter1+ter2-ter3\npredbas<-forecast(fitbas)\npredbas\n````\n\nGraficamente el modelo se comporta:\n\n````{r message=FALSE,warning=FALSE}\n\nplot(predbas,lwd=2,col=\"green2\")\n\nlines(tstrain,lwd=1,col=\"orangered\")\n````\n\n\n##Comparación de Modelos\n\n````{r message=FALSE,warning=FALSE}\n\n#Modelo Lineal\nacc_a<-accuracy(predlm)\n#Modelo Parabólico\nacc_b<-accuracy(predpol,tstrain)\n#Modelo Exponencial\nacc_c<-accuracy(predexp)\n#Modelo Logístico\nacc_d<-accuracy(predlog)\n#Modelo Gompertz\nacc_e<-accuracy(predgom)\n#Modelo Fisher-Pry\nacc_f<-accuracy(fitpry,tstrain) #Duda\n#Modelo Bass\nacc_g<-accuracy(predbas)        #Duda\n\nacc_all<-rbind(acc_a,acc_b,acc_c,acc_d,acc_e,acc_f,acc_g)\nModelos<-c(\"Lineal\",\"Parabólico\", \"Exponencial\"\n          ,\"Logístico\",\"Gompertz\",\"Fisher-Pry\",\"Bass\")\n\nperform<-data.frame(Modelos,acc_all)\n\np1<-as.list(fitlm$coeff)\np2<-as.list(regpol$coeff)\n\na1<-round(p1$\"(Intercept)\",3)  \nb1<-round(p1$trend,3)           \n\na2<-round(p2$\"(Intercept)\",3)  \nb2<-round(p2$time,3)           \nc2<-round(p2$\"I(time^2)\",3)    \n\np<-round(P,3)\nq<-round(Q,3)\nm<-round(M,3)\n\na_all<-rbind(a1,a2,\"NA\",\"NA\",\"NA\",a1,a2)\nb_all<-rbind(b1,b2,\"NA\",\"NA\",\"NA\",b1,b2)\nc_all<-rbind(\"NA\",c2,\"NA\",\"NA\",\"NA\",\"NA\",c2)\np_all<-rbind(\"NA\",\"NA\",\"NA\",\"NA\",\"NA\",\"NA\",p)\nq_all<-rbind(\"NA\",\"NA\",\"NA\",\"NA\",\"NA\",\"NA\",q)\nm_all<-rbind(\"NA\",\"NA\",\"NA\",\"NA\",\"NA\",\"NA\",m)\n\n\nparamet<-data.frame(Modelos,a=a_all,b=b_all,c=c_all,p=p_all,q=q_all,m=m_all)\n\nperform\nparamet\n````\n\n\n###**OTRAS PRUEBAS**\nModelo Bass con los datos de Cablevisón\n\n`````{r}\n\nset<-ts(c(0,0,0,6.76237,9.00095,9.7213,11.30214,13.56488,15.19591,17.01668),start=2004,end=2013,frequency=1)\ndat<-cumsum(set)\n\ny<-2004:2013\ntdat<-(y-mean(y))*2\n\nregdat= lm(dat ~ tdat + I(tdat^2))\na<-8.573783\nb<-1.035411\nc<--0.009617\n\nM<-(-b-sqrt((b^2)-(4*a*c)))/(2*c)\nP<-a/M\nQ<--c*M\n\nter1<-P*M\nter2<-(Q-P)*dat\nter3<-(Q/M)*dat^2\n\nfitbas<-ter1+ter2-ter3\nplot(y,dat,col=\"blue2\",pch=20,ylim=c(0,25),xlab=\"Años\",ylab=\"Usuarios\",main=\"Bass Model\")\nlines(y,dat,col=\"blue\")\nlines(y,fitbas,col=\"red\")\nlegend(\"topleft\",legend=c(\"Datos CV\",\"Bass Model\"),col=c(\"blue\",\"red\"),lty=1,lwd=2)\n\n````\n",
    "created" : 1437953765000.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1603244358",
    "id" : "DCF8D55",
    "lastKnownWriteTime" : 1426473924,
    "path" : "~/GitHub/Dimensionamiento-de-Redes/Actividad 1/Mod_Demanda2.Rmd",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}